

Merge Those Reconfigure Ops Phase is Pending or empty ("").

Requests in Successful/Failed/Skipped are ignored.

If any request for the same DB is Progressing (other than the current), skip now and with requeue 

Mark all earlier items in that group as Skipped (status is patched to Phase=Skipped with a condition (reasion for skipping is this config is merged in another ops requests)



If the selected name != current request name, SkipOpsReq returns true (skip current; controller requeues it after 30s).
If it matches, return false (current may proceed)







db container security context as:
securityContext:
    allowPrivilegeEscalation: false
    capabilities:
      drop:
        - ALL
    runAsGroup: 1000
    runAsNonRoot: true
    runAsUser: 1000
    seccompProfile:
      type: RuntimeDefault
----------------------------------
podTemplate Security Context as: 
      securityContext:
        fsGroup: 1000









FROM golang:1.23 AS yq

RUN set -x \
  && apt-get update \
  && apt-get install -y --no-install-recommends apt-transport-https ca-certificates

## build yq binary from ac-3.3.4 branch which has updated go dependencies
RUN set -x \
  && git clone https://github.com/gomodules/yq.git \
  && cd yq \
  && git checkout ac-3.3.4 \
  && CGO_ENABLED=0 go build -v -o /yq yq.go

FROM {ELASTICSEARCH_IMAGE} as elasticsearch

FROM alpine:3.20.2

RUN apk add --no-cache bash

ARG ES_UID=1000
ARG ES_GID=1000



COPY scripts/config-merger.sh /usr/local/bin/config-merger.sh
COPY --from=yq /yq /usr/bin/yq
COPY --from=elasticsearch /usr/share/elasticsearch/ /elasticsearch/

RUN chmod -c 755 /usr/local/bin/config-merger.sh

ENTRYPOINT ["/bin/bash","/usr/local/bin/config-merger.sh"]


I want this dir elasticsearch/  to have elasticsearch user permission. 

I want to run this container as non root

make necessary changes. 